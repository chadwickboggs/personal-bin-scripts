#!/usr/bin/env bash

USAGE="$(basename $0) <options> \n
\n
\t      Run \"grep\" through \"lsp\". \n
\n
\t      Options \n
\n
\t\t            [-h|--help]\t	This message gets printed only. \n
\t\t            [-q|--quiet]\t	Be quiet. \n
"

be_quiet=false
grep_excludes_file="${HOME}/stuff/grep_excludes.txt"

args=`getopt -o "hq" -l "help,quiet" -- "$@"`
eval set -- "$args"
while true; do
  case "$1" in
                -h | --help)	echo -e ${USAGE}; exit;;
                -q | --quiet)	be_quiet=true; shift;;
                --) shift; break;;
                *) echo "Internal error!"; exit 1;;
  esac
done

if [[ -f "${grep_excludes_file}" ]]; then
	cmd="lsp \"grep -r --exclude-from=${grep_excludes_file} $@\""
else 
	cmd="lsp \"grep -r $@\""
fi

cmd="${cmd} | grep -v target | grep -v '\.git' | grep -v tunnel | grep -v '\.idea' | grep -v '\.log' | sort -ud"

echo "	Executing \"${cmd}\""
bash -c "${cmd}"

exit $?
